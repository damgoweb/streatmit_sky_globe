# Sky Globe - 世界の今の空 要件定義書

## 1. プロジェクト基本情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Sky Globe - 世界の今の空 |
| 開発期間（予定） | 3ヶ月（MVP版） |
| 開発言語 | Python 3.8+ |
| 主要フレームワーク | Streamlit, Pydeck |
| 対象ブラウザ | Chrome, Firefox, Safari, Edge（最新版） |
| 想定同時接続数 | 100ユーザー |

## 2. 機能要件

### 2.1 必須機能（MVP版）

#### 2.1.1 3D地球儀表示機能 [F001]
**機能概要**: 3D地球儀を表示し、ユーザーが操作可能
- **入力**: ユーザーのマウス操作（回転、ズーム、パン）
- **処理**: Pydeckによる3D描画、視点変更処理
- **出力**: インタラクティブな3D地球儀
- **受入条件**:
  - [ ] 地球儀が3D表示される
  - [ ] マウスドラッグで地球儀を回転できる
  - [ ] マウスホイールでズームイン/アウトできる
  - [ ] 国境線が表示される
  - [ ] 主要都市名が表示される

#### 2.1.2 昼夜境界線表示機能 [F002]
**機能概要**: 現在の昼夜境界線を地球儀上に表示
- **入力**: 現在時刻（UTC）
- **処理**: 太陽位置計算、昼夜境界線描画
- **出力**: 昼側（明るい）と夜側（暗い）の表示切り替え
- **受入条件**:
  - [ ] 昼夜境界線が正確に表示される
  - [ ] 昼側は明るいテクスチャで表示される
  - [ ] 夜側は暗いテクスチャで表示される
  - [ ] 10分間隔で自動更新される

#### 2.1.3 天気情報取得・表示機能 [F003]
**機能概要**: OpenWeatherMap APIから天気情報を取得・表示
- **入力**: 都市名または座標
- **処理**: API呼び出し、データ解析、表示処理
- **出力**: 天気情報（気温、天候、アイコン）
- **受入条件**:
  - [ ] 気温が°C/°F切替可能で表示される
  - [ ] 天候アイコンが適切に表示される
  - [ ] 湿度、風速、気圧が表示される
  - [ ] 体感温度が表示される
  - [ ] API呼び出しエラー時の適切なエラーハンドリング

#### 2.1.4 都市検索機能 [F004]
**機能概要**: 都市名による検索とオートコンプリート
- **入力**: ユーザー入力（都市名）
- **処理**: 都市データベース検索、候補表示
- **出力**: 検索候補リスト
- **受入条件**:
  - [ ] 日本語・英語で都市検索ができる
  - [ ] オートコンプリートが機能する
  - [ ] 国名による絞り込みができる
  - [ ] 検索結果から都市を選択できる

#### 2.1.5 ランダム都市選択機能 [F005]
**機能概要**: ランダムに世界の都市を選択・表示
- **入力**: ランダムボタンクリック
- **処理**: ランダム都市選択、地球儀視点移動
- **出力**: ランダムに選択された都市の表示
- **受入条件**:
  - [ ] ランダムボタンで任意都市が選択される
  - [ ] 選択都市に地球儀の視点が移動する
  - [ ] 大陸別ランダム選択ができる

### 2.2 推奨機能（Ver2.0）

#### 2.2.1 時間軸表示機能 [F006]
- 選択都市のローカル時間表示
- タイムゾーン情報表示
- **開発優先度**: 中

#### 2.2.2 複数都市比較機能 [F007]
- 最大5都市の同時表示
- 気温・天候の比較表示
- **開発優先度**: 中

#### 2.2.3 お気に入り機能 [F008]
- 都市のお気に入り登録
- お気に入りリストからの選択
- **開発優先度**: 低

### 2.3 将来機能（Ver3.0以降）

#### 2.3.1 天気予報表示機能 [F009]
- 3日間の天気予報表示
- **開発優先度**: 低

#### 2.3.2 教育支援機能 [F010]
- 気候帯の色分け表示
- 季節説明機能
- **開発優先度**: 低

#### 2.3.3 データ可視化機能 [F011]
- 気象データのグラフ表示
- 気温推移チャート
- **開発優先度**: 低

## 3. 非機能要件

### 3.1 性能要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| 初期画面表示時間 | 3秒以内 | ページロード完了まで |
| 都市検索応答時間 | 1秒以内 | 検索実行から結果表示まで |
| 天気データ取得時間 | 2秒以内 | API呼び出しから表示まで |
| 地球儀操作レスポンス | 60FPS維持 | ブラウザ開発ツールで測定 |

### 3.2 可用性要件

| 項目 | 要件 |
|------|------|
| サービス稼働率 | 99%以上（月次） |
| API制限対応 | 1日1000回の制限内で運用 |
| エラーハンドリング | 全API呼び出しでタイムアウト・エラー処理 |

### 3.3 操作性要件

| 項目 | 要件 |
|------|------|
| ユーザビリティ | 初回利用者が5分以内に基本操作を習得 |
| アクセシビリティ | 色覚多様性に配慮した配色 |
| レスポンシブデザイン | デスクトップ・タブレット対応 |
| 多言語対応 | 日本語・英語（UI表示） |

### 3.4 セキュリティ要件

| 項目 | 要件 |
|------|------|
| APIキー管理 | Streamlit Secretsで安全に管理 |
| データ保護 | 個人情報の収集・保存なし |
| 通信セキュリティ | HTTPS通信必須 |

### 3.5 保守性要件

| 項目 | 要件 |
|------|------|
| コード品質 | PEP8準拠、型ヒント使用 |
| テスト カバレッジ | 単体テスト80%以上 |
| ドキュメント | API仕様書、運用手順書作成 |
| ログ出力 | エラー・パフォーマンス情報のログ出力 |

## 4. 技術制約・前提条件

### 4.1 技術制約

| 項目 | 制約内容 |
|------|----------|
| OpenWeatherMap API | 無料プラン：1日1000回制限 |
| Streamlit制限 | セッション管理の制限 |
| ブラウザサポート | WebGL対応ブラウザ必須 |
| Python版本 | Python 3.8以上 |

### 4.2 前提条件

- インターネット接続環境必須
- ブラウザのJavaScript有効化必須
- WebGL対応デバイス推奨

## 5. データ要件

### 5.1 都市データ

| 項目 | 仕様 |
|------|------|
| 登録都市数 | 約500都市 |
| データ形式 | CSV形式 |
| 必須項目 | 都市名（日英）、国名、緯度経度、タイムゾーン |
| 更新頻度 | 四半期ごと |

### 5.2 天気データ

| 項目 | 仕様 |
|------|------|
| データソース | OpenWeatherMap API |
| 更新間隔 | 10分間隔 |
| キャッシュ時間 | 10分間 |
| 必要データ項目 | 気温、天候、湿度、風速、気圧、体感温度、視程 |

## 6. インターフェース要件

### 6.1 外部API

| API名 | 用途 | 制限 |
|-------|------|------|
| OpenWeatherMap Current Weather | 現在天気取得 | 1日1000回 |
| OpenWeatherMap Geocoding | 都市座標取得 | 1日1000回 |

### 6.2 ユーザーインターフェース

- **レイアウト**: サイドバー + メインコンテンツ構成
- **色彩設計**: ダークテーマベース
- **フォント**: システム標準フォント使用
- **アイコン**: 天気アイコンはOpenWeatherMap標準使用

## 7. 受入基準

### 7.1 機能テスト

- [ ] 全必須機能が仕様通り動作する
- [ ] エラーハンドリングが適切に機能する  
- [ ] パフォーマンス要件を満たす
- [ ] 主要ブラウザで動作確認済み

### 7.2 品質基準

- [ ] 単体テストカバレッジ80%以上
- [ ] 結合テストが全て成功
- [ ] セキュリティ要件を満たす
- [ ] アクセシビリティ基準を満たす

### 7.3 運用基準

- [ ] デプロイ手順が文書化されている
- [ ] 運用監視項目が定義されている
- [ ] バックアップ・復旧手順が整備されている

## 8. プロジェクトスケジュール

### フェーズ1: MVP開発（8週間）

| 週 | タスク | 成果物 |
|----|--------|--------|
| 1-2 | 環境構築、基盤設計 | 開発環境、設計書 |
| 3-4 | 3D地球儀実装 | 基本地球儀表示 |
| 5-6 | 天気API連携実装 | 天気情報表示機能 |
| 7 | 都市検索・UI実装 | 完整なUI |
| 8 | テスト・デバッグ | MVP版リリース |

### フェーズ2: 機能拡張（4週間）

| 週 | タスク | 成果物 |
|----|--------|--------|
| 9-10 | 時間軸・比較機能 | Ver2.0機能 |
| 11-12 | パフォーマンス改善 | 最適化版リリース |

## 9. リスク管理

### 9.1 技術リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Pydeck 3D表示パフォーマンス問題 | 高 | 事前プロトタイプ検証 |
| OpenWeatherMap API制限超過 | 中 | キャッシュ戦略、有料プラン検討 |
| ブラウザ互換性問題 | 中 | 主要ブラウザでの定期テスト |

### 9.2 運用リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| API障害 | 中 | フォールバック機構実装 |
| 高負荷による応答遅延 | 中 | 負荷分散、キャッシュ強化 |

## 10. 変更管理

- 要件変更は文書化し、影響範囲を評価
- 機能追加は優先度を考慮してスケジュール調整
- 重要な変更は関係者承認を得る

## 11. 成功基準

### 11.1 技術的成功基準
- 全機能要件の実装完了
- 非機能要件の達成
- バグゼロでのリリース

### 11.2 ビジネス的成功基準
- 月間100ユーザーの利用
- 平均セッション時間5分以上
- ユーザー満足度4.0以上（5点満点）